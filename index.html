<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë‚´ ê³µê°„ì •ë³´ ì§€ë„</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body { margin: 0; padding: 0; }
        #map { height: 100vh; width: 100%; } /* ì „ì²´ í™”ë©´ ê½‰ ì±„ìš°ê¸° */

        /* GPS ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .gps-btn {
            position: absolute; bottom: 80px; right: 20px; z-index: 1000;
            background: white; width: 50px; height: 50px;
            border-radius: 50%; border: 2px solid #ccc;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            font-size: 24px; cursor: pointer; display: flex;
            align-items: center; justify-content: center;
        }
        .gps-btn:active { background: #eee; }
    </style>
</head>
<body>

    <div id="map"></div>
    
    <button class="gps-btn" onclick="getMyLocation()">ğŸ“</button>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // 1. ì§€ë„ ìƒì„± (ì´ˆê¸° ìœ„ì¹˜: ëŒ€í•œë¯¼êµ­ ì¤‘ì‹¬ ì¯¤)
        var map = L.map('map').setView([36.5, 127.5], 7);

        // 2. ë°°ê²½ ì§€ë„ (ì˜¤í”ˆìŠ¤íŠ¸ë¦¬íŠ¸ë§µ - ë¬´ë£Œ)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap',
            maxZoom: 19
        }).addTo(map);

        // 3. GeoJSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° (fetch í•¨ìˆ˜ ì‚¬ìš©)
        fetch('mapdata.geojson')
            .then(response => {
                if (!response.ok) throw new Error("íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return response.json();
            })
            .then(data => {
                // ë°ì´í„° ì§€ë„ì— í‘œì‹œ
                var layer = L.geoJSON(data, {
                    style: function (feature) {
                        return {
                            color: "#ff0000", // ì„  ìƒ‰ìƒ (ë¹¨ê°•)
                            weight: 3,         // ì„  ë‘ê»˜
                            opacity: 0.7       // íˆ¬ëª…ë„
                        };
                    },
                    onEachFeature: function (feature, layer) {
                        // ê°ì²´ í´ë¦­ ì‹œ ì†ì„± ì •ë³´ íŒì—… í‘œì‹œ
                        if (feature.properties) {
                            var popupContent = "";
                            for (var key in feature.properties) {
                                popupContent += "<b>" + key + ":</b> " + feature.properties[key] + "<br>";
                            }
                            layer.bindPopup(popupContent);
                        }
                    }
                }).addTo(map);

                // ë°ì´í„°ê°€ ìˆëŠ” ê³³ìœ¼ë¡œ ì§€ë„ ì´ë™
                map.fitBounds(layer.getBounds());
            })
            .catch(error => {
                console.error('ì—ëŸ¬ ë°œìƒ:', error);
                alert('ë°ì´í„° íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ì„œë²„ í™˜ê²½ í•„ìš”)');
            });

        // 4. ë‚´ ìœ„ì¹˜ ì°¾ê¸° ë¡œì§
        var myMarker = null;

        function getMyLocation() {
            if (!navigator.geolocation) {
                alert("GPSë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
                return;
            }

            // ë¡œë”© ì¤‘ í‘œì‹œ (ì˜µì…˜)
            // alert("ìœ„ì¹˜ë¥¼ ì°¾ëŠ” ì¤‘...");

            navigator.geolocation.getCurrentPosition((position) => {
                var lat = position.coords.latitude;
                var lng = position.coords.longitude;
                var acc = position.coords.accuracy;

                // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
                if (myMarker) map.removeLayer(myMarker);

                // íŒŒë€ìƒ‰ ì›ìœ¼ë¡œ ìœ„ì¹˜ í‘œì‹œ
                myMarker = L.layerGroup([
                    L.circle([lat, lng], { color: 'blue', fillColor: '#3388ff', fillOpacity: 0.2, radius: acc }),
                    L.circleMarker([lat, lng], { color: 'white', fillColor: 'blue', fillOpacity: 1, radius: 8 })
                ]).addTo(map);

                // ì§€ë„ë¥¼ ë‚´ ìœ„ì¹˜ë¡œ ì´ë™
                map.setView([lat, lng], 18); // ì¤Œ ë ˆë²¨ 18 (ìƒì„¸)

            }, (err) => {
                alert("ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”. (HTTPS í™˜ê²½ í•„ìˆ˜)");
            }, {
                enableHighAccuracy: true // ë†’ì€ ì •í™•ë„ (ë°°í„°ë¦¬ ì†Œëª¨ í¼)
            });
        }
    </script>
</body>
</html>